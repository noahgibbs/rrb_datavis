<!DOCTYPE html>
<meta charset="utf-8">
<style>

.axis--x path {
  display: none;
}

</style>
<p style="font-size: 36pt;"><b><tt>Median Run Times w/ RRB<br/> by Ruby Version </tt></b></p>
<svg width="960" height="600"></svg>
<!-- <script src="https://d3js.org/d3.v4.min.js"></script> -->
<script src="d3.v4.min.js"></script>
<script>

var svg = d3.select("svg"),
    margin = {top: 20, right: 20, bottom: 180, left: 40},
    width = +svg.attr("width") - margin.left - margin.right,
    height = +svg.attr("height") - margin.top - margin.bottom;

var x = d3.scaleLinear().rangeRound([0, width]),
    y = d3.scaleLinear().rangeRound([height, 0]);

var g = svg.append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

// Colors originally based on Rickshaw's Spectrum14 palette
// Median request timing from Rails Ruby Bench runs
var discAndRubyRawData = [
  [ "1.5", "2.0.0",  "#ecb796", 0.0, 22.468092566999985 ],
  [ "1.5", "2.1.10", "#dc8f70", 0.1, 17.034812066 ],
  [ "1.5", "2.2.7",  "#b2a470", 0.2, 15.285584917999998 ],
  [ "1.5", "2.3.4",  "#92875a", 0.3, 15.064300346499998 ],
  // Intentionally skip x == 0.4 to add a space between columns
  [ "1.8", "2.3.4",  "#e7cbe6", 0.5, 18.863417819000002 ],
  [ "1.8", "2.4.1",  "#d8aad6", 0.6, 18.327373953 ],
  [ "1.8", "2.5.1",  "#a888c2", 0.7, 16.0 ],  // Re-time this
  [ "1.8", "2.6.0",  "#9dc2d3", 0.8, 16.0 ]   // Re-time this
];

var rubyVersionData = discAndRubyRawData.map(function(row) {
  return {
    "col_title": "Ruby " + row[1] + " / Discourse " + row[0],
    "fill": row[2],
    "x":    row[3],
    "y":    row[4]
  };
});

x.domain([0.0, 0.9]);  // Add 0.1 to allow space for final bar's edges
y.domain([0.0, d3.max(rubyVersionData, function(d) { return d.y; })]);

g.append("g")
   .attr("class", "axis axis--x")
   .attr("transform", "translate(0," + height + ")")
   //.call(customXaxis);
   //.call(d3.axisBottom(x));

g.append("g")
   .attr("class", "axis axis--y")
   .call(d3.axisLeft(y))

g.selectAll(".bar")
 .data(rubyVersionData)
 .enter().append("rect")
   .attr("class", "bar")
   .attr("x", function(d) { return x(d.x); })
   .attr("y", function(d) { return y(d.y); })
   .style("fill", function(d) { return d.fill; })
   .attr("width", x(0.08))
   .attr("height", function(d) { return height - y(d.y); });

//function customXaxis(g) {
//  g.call(d3.axisBottom(x));
//  //g.selectAll(".axis--x .tick").attr("transform", "translate(0,100)");
//  g.selectAll(".axis--x .tick text").attr("transform", "translate(-15,90)rotate(-90)");
//}

</script>
